<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Bán Hàng</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6fb;
      color: #222;
    }
    header {
      background: linear-gradient(90deg, #007bff 60%, #00c6ff 100%);
      color: #fff;
      padding: 1.2rem 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .header-content {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
    }
    .logo {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 2px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .container {
      max-width: 1100px;
      margin: 2.5rem auto 0 auto;
      padding: 1rem;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.07);
    }
    h2 {
      text-align: center;
      font-weight: 700;
      color: #007bff;
      margin-bottom: 2rem;
      letter-spacing: 1px;
    }
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }
    .product {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      padding: 1.2rem 1rem 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform 0.18s, box-shadow 0.18s;
      position: relative;
    }
    .product:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 8px 32px rgba(0,123,255,0.13);
    }
    .product img {
      width: 100%;
      max-width: 200px;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1rem;
      background: #e9ecef;
    }
    .product h3 {
      margin: 0.5rem 0 0.2rem;
      font-size: 1.15rem;
      font-weight: 700;
      color: #222;
      text-align: center;
    }
    .product .price {
      color: #e53935;
      font-size: 1.15rem;
      font-weight: 700;
      margin: 0.2rem 0 0.5rem 0;
      letter-spacing: 1px;
      text-align: center;
    }
    .product p {
      margin: 0.2rem 0;
      color: #555;
      font-size: 0.98rem;
      text-align: center;
    }
    .product ul { padding-left: 0; margin: 0; list-style: none; }
    .product li { display: flex; align-items: flex-start; gap: 0.5rem; margin-bottom: 0.3rem; }
    footer {
      margin-top: 3rem;
      background: #222;
      color: #fff;
      text-align: center;
      padding: 1.2rem 0 0.7rem 0;
      font-size: 1rem;
      letter-spacing: 1px;
      border-radius: 16px 16px 0 0;
    }
    @media (max-width: 600px) {
      .container { padding: 0.5rem; }
      .header-content { flex-direction: column; gap: 0.5rem; }
      .logo { font-size: 1.3rem; }
    }
  </style>
</head>
<body>
  <div id="welcomePopup" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:3000;align-items:center;justify-content:center;">
    <div style="background:#fff;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.13);padding:1.2rem 2.2rem;min-width:260px;max-width:90vw;text-align:center;font-size:1.15rem;font-weight:600;color:#2563eb;position:relative;">
      <img id="welcomeImgHtml" src="" alt="welcome" style="max-width:220px;max-height:120px;margin-bottom:10px;display:none;border-radius:8px;"><br>
      <span id="welcomeMsgHtml">Chào mừng bạn đến với <b>SHOP HOÀNG NAM</b>!</span><br>
      <button onclick="document.getElementById('welcomePopup').style.display='none'" style="margin-top:10px;background:#2563eb;color:#fff;border:none;border-radius:6px;padding:6px 18px;font-weight:500;cursor:pointer;">Đóng</button>
    </div>
  </div>
  <header>
    <div class="header-content">
      <div class="logo" style="display:flex;align-items:center;gap:0.7rem;">
        <img src="./images/logoo.png" alt="logo" style="width:180px;height:110px;vertical-align:middle;">
        <span style="font-size:2rem;font-weight:700;letter-spacing:2px;">SHOP HOÀNG NAM</span>
      </div>
    </div>
  </header>
  <!--Phần Đầu -->
  <div class="hero-features-wrapper" style="background:#f4f6fb;padding:1.5rem 0 0.5rem 0;">
    <div class="hero-features" style="display:flex;justify-content:center;gap:2.5rem;flex-wrap:nowrap;max-width:1100px;margin:0 auto;overflow-x:auto;">
      <div class="feature" style="text-align:center;min-width:180px;">
        <div class="feature-icon"><svg width="32" height="32" fill="none" viewBox="0 0 24 24"><path stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div>
        <div class="feature-title" style="font-weight:600;color:#2563eb;margin-top:0.5rem;">Giao Hàng Tức Thì</div>
        <div class="feature-desc" style="color:#555;font-size:0.98rem;">Nhận thông tin tài khoản trong vài phút</div>
      </div>
      <div class="feature" style="text-align:center;min-width:180px;">
        <div class="feature-icon"><svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#22c55e" stroke-width="2"/><path stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M8 12l2 2 4-4"/></svg></div>
        <div class="feature-title" style="font-weight:600;color:#22c55e;margin-top:0.5rem;">100% An Toàn</div>
        <div class="feature-desc" style="color:#555;font-size:0.98rem;">Thanh toán được mã hóa và bảo mật</div>
      </div>
      <div class="feature" style="text-align:center;min-width:180px;">
        <div class="feature-icon"><svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#a78bfa" stroke-width="2"/><path stroke="#a78bfa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M8 12l2.5 2.5L16 9"/></svg></div>
        <div class="feature-title" style="font-weight:600;color:#a78bfa;margin-top:0.5rem;">Đảm Bảo Hoạt Động</div>
        <div class="feature-desc" style="color:#555;font-size:0.98rem;">Tài khoản được kiểm tra và xác minh</div>
      </div>
      <div class="feature" style="text-align:center;min-width:180px;">
        <div class="feature-icon"><svg width="32" height="32" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="#fbbf24" stroke-width="2"/><path stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2"/></svg></div>
        <div class="feature-title" style="font-weight:600;color:#fbbf24;margin-top:0.5rem;">Hỗ Trợ 24/7</div>
        <div class="feature-desc" style="color:#555;font-size:0.98rem;">Hỗ trợ khách hàng suốt ngày đêm</div>
      </div>
    </div>
  </div>
  <!--Phần Sản phẩm -->
  <div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:1.5rem;flex-wrap:wrap;">
      <h2 style="margin-bottom:0;">Sản phẩm nổi bật</h2>
      <input id="searchInput" type="text" placeholder="Tìm kiếm sản phẩm..." style="padding:8px 16px;border-radius:8px;border:1px solid #ddd;font-size:1rem;min-width:220px;">
    </div>
    <div class="products" id="products"></div>
  </div>
  <footer>
    <div style="display:flex;flex-direction:column;align-items:center;gap:0.5rem;padding:0.5rem 0;">
      <div style="font-size:1.3rem;">
        <img src="./images/logoo.png" alt="logo" style="width:210px;height:110px;vertical-align:middle;margin-right:8px;">
        <p><b>SHOP HOÀNG NAM</b></p>
      </div>
      <div style="color:#2563eb;font-size:1.05rem;">Uy tín - Chất lượng - Hỗ trợ 24/7</div>
      <div >Liên Hệ Hỗ Trợ ZALO : <b style="color:#2563eb;font-size:1.05rem;">0378787154</b></div>
      <div style="color:#888;font-size:0.98rem;">© 2025 SHOP HOÀNG NAM. Thiết kế bởi HoangNam.</div>
    </div>
  </footer>
  <script>
    // Hiện popup chào mừng khi mở web, lấy nội dung từ API, căn giữa màn hình
    window.addEventListener('DOMContentLoaded', async ()=>{
      const popup = document.getElementById('welcomePopup');
      const msgSpan = document.getElementById('welcomeMsgHtml');
      const imgEl = document.getElementById('welcomeImgHtml');
      try {
        const res = await fetch('http://localhost:3000/api/welcome');
        const data = await res.json();
        msgSpan.innerHTML = data.message || 'Chào mừng bạn đến với <b>SHOP HOÀNG NAM</b>!';
        if(data.imageUrl) {
          imgEl.src = data.imageUrl;
          imgEl.style.display = 'block';
        } else {
          imgEl.style.display = 'none';
        }
      } catch {}
      popup.style.display = 'flex';
      setTimeout(()=>{ popup.style.display = 'none'; }, 3000);
    });
    let allProducts = [];
    async function loadProducts() {
      const res = await fetch('http://localhost:3000/api/kho');
      allProducts = await res.json();
      renderProducts(allProducts);
    }
    function renderProducts(products) {
      const list = document.getElementById('products');
      list.innerHTML = '';
      if (products.length === 0) {
        list.innerHTML = '<p>Không tìm thấy sản phẩm nào.</p>';
        return;
      }
      for (const p of products) {
        const date = p.createdAt ? new Date(p.createdAt) : null;
        const monthYear = date ? `${date.getMonth() + 1}/${date.getFullYear()}` : '';
        list.innerHTML += `
          <div class="product" onclick="window.location='product.html?id=${p.id}'" style='cursor:pointer;'>
            <div style='display:flex;align-items:center;gap:8px;width:100%;'>
              <img src="${p.extraLogo || 'https://byvn.net/Egqv'}" alt="logo nhỏ" style="width:100px;height:100px;object-fit:contain;">
              <img src="${p.image || ''}" alt="${p.name}" style="flex:1;">
            </div>
            <h3>${p.name}</h3>
            <div style='color:#22c55e;font-size:0.98rem;margin-bottom:2px;'>${typeof p.stock === 'number' ? `Còn lại: <b>${p.stock}</b>` : ''}</div>
            <div class="price">${p.price ? Number(p.price).toLocaleString() : 'Liên hệ'} đ${(() => {
  if (typeof p.warrantyMonths === 'number') {
    if (p.warrantyMonths === 0) return ' | Vĩnh viễn';
    return ' | ' + p.warrantyMonths + ' tháng';
  }
  if (Array.isArray(p.variants) && p.variants.length) {
    // Lấy tháng nhỏ nhất lớn hơn 0
    const monthsArr = p.variants.map(v => v.months).filter(m => typeof m === 'number' && m > 0);
    if (monthsArr.length) {
      const minMonth = Math.min(...monthsArr);
      return ' | ' + minMonth + ' tháng';
    }
  }
  return ' | Vĩnh viễn';
})()}</div>
            <p>${p.desc || ''}</p>
            ${p.features && p.features.length ? `<ul>${p.features.map(f => `<li><span style='display:inline-block;vertical-align:middle;'><svg width=\"16\" height=\"16\" fill=\"none\" viewBox=\"0 0 24 24\"><circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"#22c55e\" stroke-width=\"2\"/><path stroke=\"#22c55e\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M8 12l2 2 4-4\"/></svg></span> <span>${f}</span></li>`).join('')}</ul>` : ''}
            <div style="position:absolute;top:10px;right:14px;font-size:0.95em;color:#007bff;opacity:0.8;">${monthYear}</div>
          </div>
        `;
      }
    }
    document.getElementById('searchInput').addEventListener('input', function() {
      const q = this.value.trim().toLowerCase();
      if (!q) return renderProducts(allProducts);
      const filtered = allProducts.filter(p =>
        (p.name && p.name.toLowerCase().includes(q)) ||
        (p.desc && p.desc.toLowerCase().includes(q)) ||
        (Array.isArray(p.features) && p.features.some(f => f.toLowerCase().includes(q)))
      );
      renderProducts(filtered);
    });
    loadProducts();
  </script>
</body>
</html>
